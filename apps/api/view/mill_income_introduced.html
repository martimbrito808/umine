<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>收益介绍</title>
    <script src="../../public/static/js/myFlexible.js"></script>
    <script src="https://kit.fontawesome.com/3dc08a1f26.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../../public/static/css/news.css">
    <link href="../../public/static/common/mui/css/mui.min.css" rel="stylesheet" />
    <style>
        /* 修改 */
        .unified-header{
            z-index: 99;
        }
        .efee-panel {
            display: grid;
            grid-template-columns: auto auto;
            grid-gap: 10px;
        }
        .efee-card{
            width: 100%;
            border-radius: 0.5em;
            position : relative;
            color: #999999;
            height: 1.5rem;
        }
        
        .efee-card .container{
            padding : 0.3rem;
            width: 100%;
            height: 100%;
            background: #F8F8F8;
            border-radius: 0.2rem;
            cursor: pointer;
        }
        .efee-card .container .header{
            text-align: center;
            font-size: 14px;
            font-weight: 200;
            padding-bottom: 0.1rem;
        }
        .efee-card .container .body{
            text-align: center;
            font-size: 12px;
        }
        .efee-card .ribbon{
            position: absolute;
            content: '9.8';
            background: #F8A52D;
            text-align: center;
            padding: 0.2em 0.5em;
            color: white;
            font-size: 10px;
            border-bottom-left-radius: 0.5em;
            border-top-right-radius: 0.5em; 
            right: 0;
            top:0;
        }
        
        .efee-card-active .container{
            background: #F8A52D;
        }
        .efee-card-active .container *{
            color: white;
        }
        .efee-card-active .ribbon{
            background: white;
            color: #F8A52D;
        }
        .btn-close-bottom-window{
            position: absolute;
            right: 42px;
            top: 20px;
            width: 32px;
            height: 32px;
            opacity: 0.3;
        }
        .btn-close-bottom-window:hover{
            opacity: 1;
        }
        
        .btn-close-bottom-window:before, .btn-close-bottom-window:after {
            position: absolute;
            left: 15px;
            content: ' ';
            height: 23px;
            width: 2px;
            background-color: #333;
        }
        .btn-close-bottom-window:before {
            transform: rotate(45deg);
        }
        .btn-close-bottom-window:after {
            transform: rotate(-45deg);
        }
        .window_top{
            padding-bottom: 0.1rem;
        }
        .pmethod-list {
            counter-reset: index;  
            padding: 0;
            width: 100%;
            background: #33333D;
            color: white;
        }

        /* List element */
        .pmethod-list > li {
            counter-increment: index; 
            display: flex;
            justify-content: space-between;
            padding: 12px 20px 12px 24px;
            box-sizing: border-box;
        }
        /* Element separation */
        .pmethod-list > li + li {
            border-top: 1px solid #3A3A44;
        }
        .pmethod-title{
            text-align: center;
            font-weight: bold;
            width: 100%
        }
        .pmethod-list > li > .icon{
            display: none;
        }
        .pmethod-selected > .icon{
            display: block !important;
        }
    </style>
</head>
<!-- 收益介绍 -->

<body style="background: #fff">
    <header class="unified-header">
        <a href="javascript:history.go(-1)">
            <img src="../../public/static/images/return.png" alt="" class="return-icon">
        </a>
        <h3 class="income-h3">{$info.name}...</h3>
    </header>
    <div class="unified-wrapper">
        <div class="income-imgBox">
            <img src="{:getfile($info.cover_2)}" alt="" class="income-img">
        </div>
        <div class="income-box">
            <h3 class="income-num">{:showprice($info.price_usdt)}<span class="income-font">USDT</span></h3>
            {if $info.price_gbtc > 0}
                <h3 class="income-num">{:showprice($info.price_gbtc)}<span class="income-font">GBTC</span></h3>
            {/if}
            <p class="income-row">
                <span class="income-label">{$info.olabel}</span>
                <span class="income-label">{$info.type == 1 ? '现货' : '预售'}</span>
                <span class="income-name" style="width:4.5rem">{$info.name}</span>
            </p>
            <ul class="income-msgList">
                <li>
                    <span class="income-msg_name">电费</span>
                    <span class="income-msg_text">{:showprice($info.dianfei,2)}元/度</span>
                </li>
                <li>
                    <span class="income-msg_name">管理费</span>
                    <span class="income-msg_text">{$info.guanlifei}%日产出</span>
                </li>
                <li>
                    <span class="income-msg_name">套保费</span>
                    <span class="income-msg_text">{:showprice($info.baoxianfei,2)}元</span>
                    <span class="income-msg_font">(新机器免保费)</span>
                </li>
                <li>
                    <span class="income-msg_name">产权</span>
                    <span class="income-msg_text">{$info.zhouqi_label}</span>
                </li>
                <li>
                    <span class="income-msg_name">预计回报率</span>
                    <span class="income-msg_text">{$info.huibaolv}</span>
                </li>
                <li>
                    <span class="income-msg_name">每日产出</span>
                    <span class="income-msg_font" style="font-weight: bold;">{:showprice($info.richanchu)} BTC</span>
                </li>
                <li>
                    <span class="income-msg_name">今日购买 {$info.rebate_at}天 后开挖</span>
                </li>
            </ul>
            <ul class="income-timeList">
                {if $info.type == 1}
                  <li>{$info.intro}</li>
                {else/}
                    <li><span class="circle"></span>售卖结束时间：{$info.jieshu_time}</li>
                    <li><span class="circle"></span>预计上架时间：{$info.shangjia_time}</li>
                {/if}
               
            </ul>
            <div class="income-bottom-box">
                <p class="income-rowAlign">
                    <img src="../../public/static/images/icon10.png" alt="">
                    优惠券
                </p>
                <a href="/api/my/discount_coupon?token={$auth.token}" class="income-link">
                    加灰度超算小助手领取优惠券
                    <img src="../../public/static/images/right_icon5.png" alt="">
                </a>
            </div>
            <span class="income-tag">{$info.category_label}</span>
        </div>
        <ul class="introduce-tab">
            <li>
                <a data-key="first" href="javascript:void(0)" class="active">
                    {$info.category_tab_label}
                    <span class="border-bottom"></span>
                </a>
            </li>
            <li>
                <a data-key="second" href="javascript:void(0)">
                    收益介绍
                    <span class="border-bottom"></span>
                </a>
            </li>
        </ul>
        <div class="introduce introduce-active" id="first">
            <div class="introduce-box">
                <div class="introduce-row">
                    <p class="align-row">
                        <img src="../../public/static/images/icon9.png" alt="">
                        {$info.category_label}
                    </p>
                    <p class="introduce-msg">此矿机为<span class="emphasis">{$info.category_label}</span>，购买后{$info.zhouqi_label}拥有产权。</p>
                </div>
                <div class="introduce-row">
                    <p class="align-row">
                        <img src="../../public/static/images/icon9.png" alt="">
                        配置全面
                    </p>
                    <p class="introduce-msg">此产品包含矿机、电源及<span class="emphasis">机位</span>。</p>
                </div>
                <div class="introduce-row">
                    <p class="align-row">
                        <img src="../../public/static/images/icon9.png" alt="">
                        专业服务
                    </p>
                    <p class="introduce-msg">购买此产品后灰度超算为您提供物流运输、矿机
                        上架、收益分发、矿机维护及维修等<span class="emphasis">一站式
                            服务</span>，免除您的后顾之忧。</p>
                </div>
            </div>
            <div class="introduce-box2">
                <p class="detailes-parameters">详细参数</p>
                <p class="detailes-row">
                    <span>矿机型号</span>
                    <span>{$info.x_1}</span>
                </p>
                <p class="detailes-row">
                    <span>矿机算力</span>
                    <span>{$info.x_2}</span>
                </p>
                <p class="detailes-row">
                    <span>矿机功率</span>
                    <span>{$info.x_3}</span>
                </p>
                <p class="detailes-row">
                    <span>支持算法</span>
                    <span>{$info.x_4}</span>
                </p>
                <p class="detailes-row">
                    <span>显存容量</span>
                    <span>{$info.x_5}</span>
                </p>
            </div>
        </div>
        <div class="introduce " id="second">
            <p class="introduce-label"><span>收益发放</span></p>
            <ul class="income-list">
                <li>
                    <p class="income-title">
                        <span class="circle2"></span>
                        收益结算公式
                    </p>
                    <p class="income-content">
                       {$info.s_1}
                    </p>
                </li>
                <li>
                    <p class="income-title">
                        <span class="circle2"></span>
                        结算时间
                    </p>
                    <p class="income-content">
                        {$info.s_2}
                    </p>
                </li>
            </ul>
            <p class="introduce-label"><span>费用收取</span></p>
            <ul class="income-list">
                <li>
                    <p class="income-title">
                        <span class="circle2"></span>
                        电费
                    </p>
                    <p class="income-content">
                       {$info.s_3}
                    </p>
                </li>
                <li>
                    <p class="income-title">
                        <span class="circle2"></span>
                        保险费
                    </p>
                    <p class="income-content">
                        {$info.s_4}
                    </p>
                </li>
                <li>
                    <p class="income-title">
                        <span class="circle2"></span>
                        管理费
                    </p>
                    <p class="income-content">
                        {$info.s_5}
                    </p>
                </li>
            </ul>
        </div>
        
        <div class="btn-box">
            
        {if $info.buy == true }
            <button class="pay-btn">立即购买</button>
        {else/}
            <button class="pay-btn" style='background: #DDDDDD;'  disabled>立即购买</button>
        {/if}
        </div>
    </div>
    <div class="mask_layer mask_layer_buy"></div>
    <div class="bottom_window bw-buy">
        <div class="window_top">
            <div class="window_top_row">
                <span class="window-tag">{$info.type == 1 ? '现货' : '预售'}</span>
                <h3>{$info.name}</h3>
                <button class="btn-close-bottom-window"></button>
            </div>
            <div class="parameter-box">
                <span class="window-label">购买数量</span>
                <div class="parameter-row param-num">
                    <button data-val='1'>1</button>
                    <button data-val='2'>2</button>
                    <button data-val='5'>5</button>
                    <button data-val='10'>10</button>
                </div>
            </div>
            <div class="window_row_between">
                <span class="window-label">优惠券</span>
                <a href="javascript:void(0)" class="coupon-link">
                    未使用优惠券
                    <img src="../../public/static/images/right_icon2.png" alt="">
                </a>
            </div>
            <div class="window_row_between" style="display: block;">
                <div class="window-label" style="margin-bottom:15px;">订单金额</div>
                <div class="order-amount" style="margin-bottom:15px;">
                    <span class='danjia danjia-usdt'>{:showprice($info.price_usdt)}</span><span class="fontSmall">USDT</span>
                </div>
                {if $info.price_gbtc > 0}
                    <div class="order-amount" style="margin-bottom:15px;">
                        <span class='danjia danjia-gbtc'>{:showprice($info.price_gbtc)}</span><span class="fontSmall">GBTC</span>
                    </div>
                {/if}
            </div>
            {if $info.dianfei > 0}
            <div class="parameter-box">
                <span class="window-label">预缴电费</span>
                <div class="parameter-row  efee-panel">
                    {volist name='efees' id='efee'}
                        <div data-val='{$efee.id}' amount='{$efee.amount}' class="efee-card">
                            <div class="container">
                                <p class="header">预缴{$efee.days}天</p>
                                <p class="body">{$efee.amount} USDT/台</p>  
                            </div>
                            {if $efee.rebate > 0}
                                <p class="ribbon">{$efee.rebate_label}折</p>
                            {/if}
                        </div>
                    {/volist}
                </div>
            </div>
            <!--
            <div class="window_row_between">
                <span class="window-label">金额</span>
                <span class="order-amount"><span class='efee'>{$efees[0]['amount']}</span><span class="fontSmall">USDT</span></span>
            </div>
            -->
            {/if}
            {if $info.dianfei <= 0}
            {/if}
        </div>
        <p class="available-capital">可用资产： {:showprice($selfUsdt)} USDT</p>
        <p class="available-capital">可用资产： {:showprice($selfGbtc)} GBTC</p>
        <div class="window_bottom">
            <input type="hidden" id="mill_id" value="{$info.id}" />
            <input type="hidden" id="num" value="" />
            {if $info.dianfei <= 0}
                <input type="hidden" id="efee_id" value="1" />
            {/if}
            {if $info.dianfei > 0}
                <input type="hidden" id="efee_id" value="0" />
            {/if}
            <input type="hidden" id="efee_amount" value="0" />
            <button id='buynow'>购买</button>
        </div>
    </div>
    <div class="mask_layer mask_layer_pmethod"></div>
    <div class="bottom_window bw-pmethod">
        <ul class="pmethod-list">
            <li class="pmethod-header"=>
                <span><i class="fas fa-angle-left"></i></span>
                <span class="pmethod-title">可用资产</span>
            </li>
            {volist name='payMethods' id='payMethod'}
                <li class="pmethod-item" data-id="{$payMethod.id}">
                    <span>{$payMethod.name}</span>
                    <span class="icon"><i class="fas fa-check"></i></span>
                </li>
            {/volist}
        </ul>
        <input type="hidden" name="pmethod" id="pmethod" value="0">
    </div>
    <script src="../../public/static/common/jQuery/jquery-3.2.1.js"></script>
    <script src="../../public/static/common/mui/js/mui.min.js"></script>
    
    <script>
        //选项卡
        $('.introduce-tab li a').click(function () {
            var that = $(this);
            var key = that.data('key');
            $('.introduce-tab li a').removeClass('active');
            that.addClass('active');
            $('.introduce').removeClass('introduce-active');
            $('#' + key).addClass('introduce-active');
        });

        //底部弹框
        $('.pay-btn').click(function () {
            $('.bw-buy,.mask_layer_buy').slideDown(200).css('display', 'flex');
        })
        $('.mask_layer_buy,.cancel-btn').click(function () {
            $('.bw-buy,.mask_layer_buy').slideUp(200).css('display', 'flex');
        })
        $('.btn-close-bottom-window').click(() => {
            $('.bw-buy,.mask_layer_buy').slideUp(200).css('display', 'flex');
        })
        $('.mask_layer_pmethod').click(function () {
            $('.bw-pmethod,.mask_layer_pmethod').slideUp(200).css('display', 'flex');
            $('.bw-buy,.mask_layer_buy').slideDown(200).css('display', 'flex');
        })
        //购买数量选择
        $('.param-num button').click(function () {
            var that = $(this);
            var num = that.data('val');
            var money = "{:showprice($info.price_usdt)}"
            var money_gbtc = "{:showprice($info.price_gbtc)}"
            var allmoney = money * num;
            var allmoneygbtc = money_gbtc * num;
            $('#num').val(num);
            that.siblings().removeClass('selected');
            that.addClass('selected');
            $('.danjia-usdt').text(allmoney);
            $('.danjia-gbtc').text(allmoneygbtc);
            getEfee();
        });
        //购买数量选择
        $('.efee-card').click(function () {
            var that = $(this);
            var id = that.data('val');
            var amount = that.attr('amount');
            that.siblings().removeClass('efee-card-active');
            that.addClass('efee-card-active');
            $('#efee_id').val(id)
            $('#efee_amount').val(amount);
            getEfee();
        });
        function getEfee()
        {
            $('.efee').text( $('#efee_amount').val() * $('#num').val() )
        }
        $('.pmethod-item').click(function(){
            const id = $(this).attr('data-id')
            $('.pmethod-item').removeClass('pmethod-selected')
            $(this).addClass('pmethod-selected')
            $('#pmethod').val(id)
        })
        let lock = false;
        $('#buynow').click(function() {
            if($('#pmethod').val() == 0)
            {
                $('.bw-buy,.mask_layer_buy').slideUp(200).css('display', 'flex');
                $('.bw-pmethod,.mask_layer_pmethod').slideDown(200).css('display', 'flex');
            }
            else
            {
                buyMill()
            }
        })
        $('.pmethod-header').click(function(){
            $('.bw-pmethod,.mask_layer_pmethod').slideUp(200).css('display', 'flex');
            $('.bw-buy,.mask_layer_buy').slideDown(200).css('display', 'flex');
            
        })
        const buyMill = () => {
            let mill_id = $('#mill_id').val();
            const efee_id = $('#efee_id').val()
            let num = $('#num').val();
            let token = localStorage.getItem('token');
 
            if(num == undefined || num == '') {
                mui.toast('请选择购买数量')
                return false;
            }
            if(mill_id == undefined || mill_id == '' ) {
                mui.toast('非法请求')
                return false;
            }
            if(lock == true) {
                return false;
            }
            if(efee_id == 0 || efee_id == undefined)
            {
                mui.toast('请选择预缴电费')
                return false;
            }
            lock = true;
            
            $.ajax({
                type : "POST",
                contentType: "application/json;charset=UTF-8",
                url : "/api/mill/buy_mill",
                data : JSON.stringify({
                    mill_id:mill_id,
                    num: num,
                    token: token,
                    efee_id:efee_id,
                    pmethod:$('#pmethod').val(),
                }),
                success : function(result) {
                    if(result.code == 200) {
                        setTimeout(function(){
                            window.location.reload();
                        },2000);
                    }else{
                        lock = false;
                    }
                    mui.toast(
                        result.msg
                    )
                    console.log(result)
                },
                //请求失败，包含具体的错误信息
                error : function(e){
                    lock = false;
                    mui.toast(
                        '出错啦，请稍后再试',
                    )
                }
            });
        }
        
        
    </script>
</body>

</html>