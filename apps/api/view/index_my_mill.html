<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>我的矿机</title>
    <script src="../../public/static/js/myFlexible.js"></script>
    <link rel="stylesheet" href="../../public/static/css/news.css">
    <link rel="stylesheet" href="../../public/static/common/mui/css/mui.min.css">
    <style>
        .unified-header {
            background: #F3F3F5!important;
        }
        .unified-wrapper{
            padding: 0.9rem 0.3rem 1.1rem!important;
            box-sizing: border-box;
        }
        .btn-efee{
            height: 0.55rem!important;
            padding: 0 0.48rem!important;
            font-size: 0.26rem;
            margin-right: 0.08rem!important;
            border-radius: 0.45rem;
            border: none!important;
            background: #EFEFF1;
            color: #333333;
            margin-bottom: 0.12rem!important;
        }
        .efee-panel {
            display: grid;
            grid-template-columns: auto auto;
            grid-gap: 10px;
        }
        .efee-card{
            width: 100%;
            border-radius: 0.5em;
            position : relative;
            color: #999999;
            height: 1.5rem;
        }
        
        .efee-card .container{
            padding : 0.3rem;
            width: 100%;
            height: 100%;
            background: #F8F8F8;
            border-radius: 0.2rem;
            cursor: pointer;
        }
        .efee-card .container .header{
            text-align: center;
            font-size: 14px;
            font-weight: 200;
            padding-bottom: 0.1rem;
        }
        .efee-card .container .body{
            text-align: center;
            font-size: 12px;
        }
        .efee-card .ribbon{
            position: absolute;
            content: '9.8';
            background: #F8A52D;
            text-align: center;
            padding: 0.2em 0.5em;
            color: white;
            font-size: 10px;
            border-bottom-left-radius: 0.5em;
            border-top-right-radius: 0.5em; 
            right: 0;
            top:0;
        }
        
        .efee-card-active .container{
            background: #F8A52D;
        }
        .efee-card-active .container *{
            color: white;
        }
        .efee-card-active .ribbon{
            background: white;
            color: #F8A52D;
        }
        .btn-close-bottom-window{
            position: absolute;
            right: 42px;
            top: 20px;
            width: 32px;
            height: 32px;
            opacity: 0.3;
        }
        .btn-close-bottom-window:hover{
            opacity: 1;
        }
        
        .btn-close-bottom-window:before, .btn-close-bottom-window:after {
            position: absolute;
            left: 15px;
            content: ' ';
            height: 23px;
            width: 2px;
            background-color: #333;
        }
        .btn-close-bottom-window:before {
            transform: rotate(45deg);
        }
        .btn-close-bottom-window:after {
            transform: rotate(-45deg);
        }
        .window_top{
            padding-bottom: 0.1rem;
        }
    </style>
</head>
<!-- 我的矿机 -->

<body style="background-color: #F3F3F5;">
    <header class="unified-header">
        <a href="javascript:history.go(-1)">
            <img src="../../public/static/images/return.png" alt="" class="return-icon">
        </a>
        <h3>{$info.name}</h3>
    </header>
    <div class="unified-wrapper">
        <div class="mill-card-head">
            <p class="safeguard-label">
                <span class="circle"></span>
                保障中
            </p>
            <ul class="mill-card-list">
                <li>
                    <span>昨日收益</span>
                    <span>{:showprice($info.yesterday_earnings)}</span>
                    <span>≈¥{:showprice($info.yesterday_earnings_cny)}</span>
                </li>
                <li>
                    <span>累计收益</span>
                    <span>{:showprice($info.count_earnings)}</span>
                    <span>≈¥{:showprice($info.count_earnings_cny)}</span>
                </li>
            </ul>
            <!--<p class="mill-card-text">AI Mine收益提升<span> +0.88%</span></p>-->
        </div>
        <div class="mill-box">
            <ul class="mill-msg-list">
                <li> 
                    <span>{$info.suanli}Th/s</span>
                    <span>我的算力</span>
                </li>
                <li>
                    <span>{$machineNum}台</span>
                    <span>矿机数量</span>
                </li>
                <li>
                    <span>{$info.location}</span>
                    <span>矿场位置</span>
                </li>
            </ul>
        </div>
        <div class="mill-box">
            <ul class="mill-column-list">
                <li>
                    <span>预计今日产出</span>
                    <span>{:showprice($info.shouyi_format)}</span>
                </li>
                <li>
                    <span>电费</span>
                    <span>{:showprice($info.dianfei, 2)}元/度</span>
                </li>
                <li>
                    <span>管理费</span>
                    <span>{$info.guanlifei}%日产出</span>
                </li>
                <li>
                    <span>购买日期</span>
                    <span>{$info.buy_time}</span>
                </li>
                <li>
                    <span>开挖日期</span>
                    <span>{$info.earning_date}</span>
                </li>
                <li>
                    <span>电费剩余</span>
                    <span>{$info.efee_date_balance}</span>
                </li>
                <li style="margin-bottom: 0px;">
                    <button class="btn-efee">续缴电费</button>
                </li>
                <li>
                    <span> 续缴电费</span>
                    <span>{$info.buy_time}</span>
                </li>
                <li>
                    <span>产权</span>
                    <span>{$info.label}</span>
                </li>
                <li>
                    <span>过期日期</span>
                    <span>{$info.end_date}</span>
                </li>
            </ul>
            <a href="/api/my/cost?token={$token}" class="deductions-way">
                抵扣方式
                <img src="../../public/static/images/right_icon5.png" alt="">
            </a>
        </div>
        <div class="mill-box">
            <h3 class="mill-top-title">收益记录</h3>
            <p class="mill-top-msg">
                <span>时间</span>
                <span>收益/收益提升</span>
            </p>
            <ul class="gain-recording">
                {if count($shouyilist) > 0 }
                    {volist name='shouyilist' id='sl'} 
                        <li>
                            <span>{$sl.earnings_date}</span>
                            <span>{:showprice($sl.price)} 
                            {if !empty($sl.yesterday_earnings)}
                                /{if $sl.price > $sl.yesterday_earnings && $sl.yesterday_earnings != 0 }+{else/}-{/if}{$sl.earnings_up}%
                            {/if}
                            </span>
                        </li>
                    {/volist}
                {else/}
                    <!-- 暂无数据时显示 -->
                    <div class="no_data">
                        <img src="images/null2.png" alt="">
                        暂无数据
                    </div>
                {/if}
            </ul>
        </div>
    </div>
    <footer class="mill-footer">
        <button id='up' {if $info.status ==1 }  disabled style='color:#B4B4B6' {/if}>一键上架</button>
        <button id='down' {if $info.status ==0 } disabled style='color:#B4B4B6' {/if}>一键下架</button>
    </footer>
    <div class="mask_layer"></div>
    <div class="bottom_window">
        <div class="window_top">
            {if $info.dianfei > 0}
                <div class="parameter-box">
                    <span class="window-label">预缴电费</span>
                    <div class="parameter-row  efee-panel">
                        {volist name='efees' id='efee'}
                            <div data-val='{$efee.id}' amount='{$efee.amount}' class="efee-card">
                                <div class="container">
                                    <p class="header">预缴{$efee.days}天</p>
                                    <p class="body">{$efee.amount} USDT/台</p>  
                                </div>
                                {if $efee.rebate > 0}
                                    <p class="ribbon">{$efee.rebate_label}折</p>
                                {/if}
                            </div>
                        {/volist}
                    </div>
                </div>
            {/if}
        </div>
        <p class="available-capital">可用资产： {:showprice($selfUsdt)} USDT</p>
        <div class="window_bottom">
            {if $info.dianfei <= 0}
                <input type="hidden" id="efee_id" value="1" />
            {/if}
            {if $info.dianfei > 0}
                <input type="hidden" id="efee_id" value="0" />
            {/if}
            <input type="hidden" id="buy-time" value="{$buy_time}">
            <input type="hidden" id="mill-id" value="{$info['mill_id']}">
            <button id='btn-buy-efee'>购买</button>
        </div>
    </div>
</body>
<script src="../../public/static/js/jquery-3.2.1.js"></script>
<script src="../../public/static/common/mui/js/mui.min.js"></script>
<script type="text/javascript" charset="utf-8">
    let token = "{$token}";
    let user_mill_id = "{$info.id}";
    
    $('#up').click(function() {
        $.ajax({
            url:"/api/index/millChange",
            data: {'token':token,'id':user_mill_id,type:'1'},
            success:function(res){
                mui.toast(res.msg);
                setTimeout(function(){
                    window.location.reload();
                },2000)
            }
        });
    })
    $('#down').click(function() {
         $.ajax({
            url:"/api/index/millChange",
            data: {'token':token,'id':user_mill_id,type:'0'},
            success:function(res){
                mui.toast(res.msg);
                setTimeout(function(){
                    window.location.reload();
                },2000)
            }
        });
    })
    //购买数量选择
    $('.efee-card').click(function () {
        var that = $(this);
        var id = that.data('val');
        that.siblings().removeClass('efee-card-active');
        that.addClass('efee-card-active');
        $('#efee_id').val(id)
    });
    $('.btn-efee').click(() => {
        $('.bottom_window,.mask_layer').slideDown(200).css('display', 'flex');
    })
    $('.mask_layer,.cancel-btn').click(function () {
        $('.bottom_window,.mask_layer').slideUp(200).css('display', 'flex');
    })
    
    $('#btn-buy-efee').click(() => {
        const mill_id = $('#mill-id').val()
        const efee_id = $('#efee_id').val()
        const buy_time = $('#buy-time').val()
        if(efee_id == 0)
        {
            mui.toast('请选择预缴电费')
            return false;
        }
        const data = {
            mill_id:mill_id,
            efee_id:efee_id,
            buy_time:buy_time,
            token: token,
        }
        
        $.ajax({
            type : "POST",
            contentType: "application/json;charset=UTF-8",
            url : "/api/index/buy_efee",
            data : JSON.stringify({
                mill_id:mill_id,
                efee_id:efee_id,
                buy_time:buy_time,
                token: token,
            }),
            success : function(result) {
                if(result.code == 200) {
                    setTimeout(function(){
                        window.location.reload();
                    },2000);
                }else{
                }
                mui.toast(
                    result.msg
                )
            }
        })
    })
</script>
</html>