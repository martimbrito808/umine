<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>节点</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="stylesheet" href="../../public/static/css/reset.css">
    <script>
        var width = document.documentElement.clientWidth;
        document.documentElement.style.fontSize = width/7.5 + 'px';
    </script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.js"></script>
    <script src="../../public/static/layer/layer.js"></script>
    <style>
        body{

            background: #F5F5F5;
        }
        .header{
            background: #fff;
            position: relative;
            padding: 0 .3rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: .95rem;

        }
        .container{
            position: relative;
        }
        .jiedian{
            font-size: .44rem;
            font-family: SourceHanSansCN-Bold;
            color: #2B2A3C;
        }
        .jilu{
            font-size: .3rem;
            font-family: Source Han Sans CN;
            font-weight: 400;
            color: #2B2A3C;
        }
        .tab-content{
            background: #fff;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        .tab{
            width: 2.75rem;
            height: .96rem;
            text-align: center;
            line-height: .96rem;
            font-size: .26rem;
            font-family: Source Han Sans CN;
            font-weight: 400;
            color: #1A1826;
        }
        .tab-select{
            height: .9rem;
            border-bottom: .06rem solid #E3B874;;
        }
        .jiedian-list{
            padding: .3rem ;
            background: #FFFFFF;
            height: calc(100vh - 3.07rem);
            overflow: scroll;
        }
        .jiedian-head-item{
            background: #FFFFFF;
            border: 1px solid #E3B874;
            opacity: 1;
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            padding: .4rem 0 .2rem 0;
        }
        .heade-item-unit>div{
            position: relative;
        }
        .head-second,.head-third{
            width: 1.4rem;
            height: 1.4rem;
        }
        .head-first{
            width: 1.85rem;
            height: 1.85rem;
        }
        .head-name{
            display: block;
            margin-top: .17rem;
            font-size: .3rem;
            font-family: Source Han Sans CN;
            font-weight: 400;
            color: #1A1826;
            text-align: center;
        }
        .head-first-flag{
            position: absolute;
            bottom: .47rem;
            right: .1rem;
            height: .58rem;
        }
        .head-second-flag, .head-third-flag{
            position: absolute;
            bottom: .47rem;
            right: .1rem;
            height: .48rem;
        }
        .jiedian-item-num{
            margin-top: .22rem;
            display: block;
            text-align: center;
            font-size: .26rem;
            font-family: Arial;
            font-weight: bold;
            color: #E3B874;
        }
        .jiedian-head-item-label{
            margin-top: .08rem;
            display: block;
            text-align: center;
            font-size: .26rem;
            font-family: Source Han Sans CN;
            font-weight: 400;
            line-height: 32px;
            color: #999999;
        }
        .jiedian-item-btn{
            display: block;
            margin: 0 auto;
            margin-top: .22rem;
            text-align: center;
            width: 1.12rem;
            height: .48rem;
            line-height: .48rem;
            background: #E3B874;
            opacity: 1;
            border-radius: 2rem;
            font-size: .24rem;
            font-family: Source Han Sans CN;
            font-weight: 400;
            color: #FFFFFF;
        }
        .jiedian-item{
            margin-top: .2rem;
            padding: .5rem .45rem .4rem .45rem;
            background: #FFFFFF;
            border: 1px solid #E3B874;
            display: flex;
            /*justify-content: space-around;*/
            align-items: center;
        }
        .jiedian-item-rank{
            font-size: .34rem;
            font-family: Arial;
            font-weight: 400;
            color: #E3B874;
            margin-right: .33rem;
        }
        .jiedian-item-head{
            width: .98rem;
            height: .98rem;
            margin-right: .21rem;
        }
        .jiedian-item-name{
            display: block;
            font-size: .3rem;
            font-family: Source Han Sans CN;
            font-weight: 400;
            color: #1A1826;
            margin-bottom: .2rem;
        }
        .jiedian-item-label{
            margin-right: .1rem;
            font-size: .26rem;
            font-family: Source Han Sans CN;
            font-weight: 400;
            color: #1A1826;
        }
        .jiedian-item-text{
            font-size: .26rem;
            font-family: Arial;
            font-weight: bold;
            color: #E3B874;
        }
        .jiedian-item-myRank{
            display: block;
            font-size: .26rem;
            font-family: Source Han Sans CN;
            font-weight: 400;
            color: #999999;
            margin-bottom: .14rem;
            text-align: center;
        }
        .jiedian-item-btn{
            width: 1.12rem;
            height: .48rem;
            background: #E3B874;
            opacity: 1;
            border-radius: 2rem;
        }
        .jiedian-item-l1{
            width: 1.7rem;
        }
        .jiedian-item-l2{
            margin-left: auto;
        }
        .foot-nav{
            border-top: 1px solid #E9E9E9;
            height: 1.16rem;
            display: flex;
            align-items: center;
            background: #fff;
            justify-content: space-around;
            position:fixed ; bottom:0; width:100%;
        }
        .foot-nav-item{

        }
        .nav-item-img{
            width: .5rem;
            height: .5rem;
        }
        .nav-item-text{
            display: block;
            margin-top: .12rem;
            font-size: .24rem;
            font-family: Source Han Sans CN;
            font-weight: 400;
            color: #9A999E;
        }
        .sqjd-btn{
            position: absolute;
            bottom: 2rem;
            left: .24rem;
            display: block;
            width: 1.46rem;
            height: 1.66rem;
            background: url("../../public/static/images/shengqingjiedian.png");
            background-size: contain;
        }
        .nav-item-img-home{
            background: url("../../public/static/images/home.png");
            background-size: contain;
        }
        .nav-item-img-kuangji{
            background: url("../../public/static/images/kuangji.png");
            background-size: contain;
        }
        .nav-item-img-jiedian{
            background: url("../../public/static/images/jiedian.png");
            background-size: contain;
        }
        .nav-item-img-money{
            background: url("../../public/static/images/money.png");
            background-size: contain;
        }
        .nav-item-img-my{
            background: url("../../public/static/images/my.png");
            background-size: contain;
        }
        .foot-nav-item-selected .nav-item-img-home{
            background: url("../../public/static/images/home-sel.png");
            background-size: contain;
        }
        .foot-nav-item-selected .nav-item-img-kuangji{
            background: url("../../public/static/images/kuangji-sel.png");
            background-size: contain;
        }
        .foot-nav-item-selected .nav-item-img-jiedian{
            background: url("../../public/static/images/jiedian-sel.png");
            background-size: contain;
        }
        .foot-nav-item-selected .nav-item-img-money{
            background: url("../../public/static/images/money-sel.png");
            background-size: contain;
        }
        .foot-nav-item-selected .nav-item-img-my{
            background: url("../../public/static/images/my-sel.png");
            background-size: contain;
        }
        .dialog{
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        .mask{
            height: 100%;
            width: 100%;
            background: #000000;
            opacity: 0.3;
        }
        .dialog-body{
            position: absolute;
            left: 50%;
            top: 50%;
            margin-top: -2.95rem;
            margin-left: -3.325rem;
            width: 6.65rem;
            height: 5.70rem;
            padding: .6rem .46rem 0 .46rem;
            background: #FFFFFF;
            border: 1px solid #707070;
            opacity: 1;
            border-radius: .1rem;
        }
        /*.dialog-text{*/
        /*    display: block;*/
        /*    margin-top: .8rem;*/
        /*    text-align: center;*/
        /*    font-size: .3rem;*/
        /*    font-family: Source Han Sans CN;*/
        /*    font-weight: bold;*/
        /*    color: #333333;*/
        /*}*/
        .dialog-footer{
            margin-top: .9rem;
            display: flex;
            justify-content: space-around;
        }
        .dialog-btn{
            width: 1.92rem;
            height: .8rem;
            opacity: 1;
            border-radius: 2rem;
        }
        .cancel-btn{
            background: #FFFFFF;
            border: 1px solid #E3B874;
            font-size: .3rem;
            font-family: Source Han Sans CN;
            font-weight: 400;
            color: #E3B874;
        }
        .ok-btn{
            background: #E3B874;
            font-size: .3rem;
            font-family: Source Han Sans CN;
            font-weight: 400;
            color: #FFFFFF;
        }
        .dialog-title{
            font-size: .3rem;
            font-family: Source Han Sans CN;
            font-weight: bold;
            /*line-height: 32px;*/
            color: #333333;
            text-align: center;
        }
        .dialog-label{
            margin-right: .15rem;
        }
        .dialog-c1{
            margin-top: .47rem;
            font-size: .26rem;
            font-family: Source Han Sans CN;
            font-weight: 400;
            color: #333333;
        }
        .dialog-input{
            margin-top: .43rem;
            width: 5.73rem;
            height: .8rem;
            background: #FFFFFF;
            border: 1px solid #999999;
            opacity: 1;
            border-radius: .1rem;
            font-size: .3rem;
            font-family: Source Han Sans CN;
            font-weight: 400;
            line-height: .8rem;
            padding: 0 .26rem;
        }
        .model{
            position: absolute;
            top: 50%;
            left: 50%;
            margin-left: -2.37rem;
            margin-top: -0.555rem;
            width: 4.74rem;
            height: 1.11rem;
            background: #000000;
            opacity: 0.6;
            font-size: .3rem;
            font-family: Source Han Sans CN;
            font-weight: 400;
            color: #FFFFFF;
            text-align: center;
            line-height: 1.11rem;
        }
    </style>
</head>
<body>
<div class="header">
    </head>
    <span class="jiedian">节点</span>
    <a href='/api/node/voteList?token={$data.token}'><span class="jilu">投票记录</span></a>
</div>
<div class="container">
    <div class="tab-content">
        <a href="/api/node/index.html?token={$data.token}&type=1" class="tab {if input('type') == 1 || empty(input('type')) } tab-select {/if}">常规节点</a>
        <a href="/api/node/index.html?token={$data.token}&type=2" class="tab {if input('type') == 2 } tab-select {/if}">超级节点</a>
    </div>
    <div class="jiedian-list">
        <div class="jiedian-head-item">
            {volist name='list' id='lfl' offset="0" length='3' key="k"}
            <div class="heade-item-unit">
                <div>
                    <img class="head-second" src="{$lfl.cover}" alt="">
                    <span class="head-name">{$lfl.title} </span>
                    <img class="head-second-flag" src="../../public/static/images/{switch name="$k" }
                            {case value="1"}{if count($list) > 1}second.png {else/}first.png {/if}{/case}
                            {case value="2"}{if count($list) > 1}first.png {else/}second.png {/if}{/case}
                            {case value="3"}third.png{/case}
                        {/switch}" alt="">
                </div>
                <span class="jiedian-item-num">{$lfl.vote}</span>
                <span class="jiedian-head-item-label">投票数量</span>
                <button class="jiedian-item-btn toupiao" data-id="{$lfl.id}" data-title="{$lfl.title}">投票</button>
            </div>
            {/volist}
        </div>
        {volist name='list' id='ll' offset="3" key='ks'}
            <div class="jiedian-item">
                <span class="jiedian-item-rank">{$ks+3}</span>
                <img class="jiedian-item-head" src="{$ll.cover}" alt="">
                <div class="jiedian-item-l1">
                    <span class="jiedian-item-name">{$ll.title}</span>
                    <span class="jiedian-item-label">投票数量:</span><span class="jiedian-item-text">{$ll.vote}</span>
                </div>
                <div class="jiedian-item-l2">
                    {if $ll.user_id == $data['user_id'] }
                    <span class="jiedian-item-myRank">我的排名</span>
                    {/if}
                    <button class="jiedian-item-btn toupiao" data-id="{$ll.id}" data-title="{$ll.title}"}>投票</button>
                </div>
            </div>
        {/volist}
    </div>
    <div class="foot-nav">
        {if condition="$data.token"}
            <a href="/api/index/index.html?token={$data.token}" class="foot-nav-item">
                <div class="nav-item-img nav-item-img-home"></div>
                <span class="nav-item-text">首页</span>
            </a>
            <a href="/api/mill/mill.html?token={$data.token}" class="foot-nav-item">
                <div class="nav-item-img nav-item-img-kuangji"></div>
                <span class="nav-item-text">矿机</span>
            </a>
            <a href="/api/node/index.html?token={$data.token}" class="foot-nav-item foot-nav-item-selected">
                <div class="nav-item-img nav-item-img-jiedian"></div>
                <span class="nav-item-text">节点</span>
            </a>
            <a href="/api/money/money.html?token={$data.token}" class="foot-nav-item">
                <div class="nav-item-img nav-item-img-money"></div>
                <span class="nav-item-text">财富</span>
            </a>
            <a href="/api/my/my.html?token={$data.token}" class="foot-nav-item">
                <div class="nav-item-img nav-item-img-my"></div>
                <span class="nav-item-text">我的</span>
            </a>
        {else/}
             <a href="" class="foot-nav-item">
                <div class="nav-item-img nav-item-img-home"></div>
                <span class="nav-item-text">首页</span>
            </a>
            <a href="" class="foot-nav-item">
                <div class="nav-item-img nav-item-img-kuangji"></div>
                <span class="nav-item-text">矿机</span>
            </a>
            <a href="" class="foot-nav-item foot-nav-item-selected">
                <div class="nav-item-img nav-item-img-jiedian"></div>
                <span class="nav-item-text">节点</span>
            </a>
            <a href="" class="foot-nav-item">
                <div class="nav-item-img nav-item-img-money"></div>
                <span class="nav-item-text">财富</span>
            </a>
            <a href="" class="foot-nav-item">
                <div class="nav-item-img nav-item-img-my"></div>
                <span class="nav-item-text">我的</span>
            </a>
        {/if}
    </div>
    <a href='/api/node/apply_step1.html?token={$data.token}' class="sqjd-btn"></a>
</div>
<div class="dialog">
    <div class="mask"></div>
    <div class="dialog-body">
        <div class="dialog-content">
            <p class="dialog-title">
                投票参与pos挖矿，获取收益
            </p>
            <div class="dialog-c1"><span class="dialog-label">节点名称:</span><span class="dialog-text node-title">志愿者联盟</span></div>
            <input type="text" class="dialog-input" id='num' placeholder="请输入整数ER">
        </div>
        <div class="dialog-footer">
            <button class="dialog-btn cancel-btn">取消</button>
            <button class="dialog-btn ok-btn" data-id=""> 确认</button>
        </div>
    </div>
</div>
<script type="text/javascript" charset="utf-8">
    /**
     * 投票按钮
     */
    $('.toupiao').click(function() {
        $('.dialog').show();
        $('.node-title').text($(this).data('title'));
        $('.ok-btn').attr('data-id',$(this).data('id'));
    })
    /**
     * 取消按钮
     */
    $('.cancel-btn').click(function() {
        $('.dialog').hide();    
    });
    /**
     * 确定投票按钮
     */
     lock = false;
    $('body').on('click', '.ok-btn', function () {
        let node_id = $(this).attr('data-id');
        let token = "{$data.token}";
        let num = $('#num').val();
        if(num == undefined || num == '') {
            layer.msg('请输入投票数量');
            return false;
        }
        if(lock == true) {
            return false;
        }
        lock = true;
        
        $.ajax({
            type : "POST",
            contentType: "application/json;charset=UTF-8",
            url : "/api/node/vote",
            data : JSON.stringify({
                node_id: node_id,
                token: token,
                num: num,
            }),
            success : function(result) {
                if(result.code == 200) {
                    setTimeout(function(){
                        window.location.reload();
                        // window.location.href="/api/node/index?token={$data.token}";
                    },2000);
                }else{
                    lock = false;
                }
                layer.msg(result.msg);
            },
            //请求失败，包含具体的错误信息
            error : function(e){
                lock = false;
                layer.msg('出错了,请稍后再试');
            }
        });
    })
</script>

</body>
</html>