<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{$money.name}</title>
    <script src="../../public/static/js/myFlexible.js"></script>
    <link rel="stylesheet" href="../../public/static/css/news.css">
    <link href="../../public/static/common/mui/css/mui.min.css" rel="stylesheet" />
</head>
<!-- USDT生币宝定期理财 -->

<style>
    .layui-layer-btn a {
    height: 28px;
    line-height: 28px;
    margin: 5px 5px 0;
    padding: 0 15px;
    border: 1px solid #dedede;
    background-color: #fff;
    color: #333;
    border-radius: 2px;
    font-weight: 400;
    cursor: pointer;
    text-decoration: none;
    font-size: 10px;
}

.layui-layer-content{
        height: 105px !important;
}
 body .demo-class .layui-layer-btn0{
  border-color: #E6E3E6;
  background-color: #FFF;
  color: black;
 }
 body .demo-class .layui-layer-btn1{
  border-color: #DEAF5F;
  background-color: #DEAF5F;
  color: #fff;
 }
</style>

<body style="background-color: #fff;">
    <header class="money-header">
        <a href="javascript:history.go(-1)">
            <img src="../../public/static/images/return2.png" alt="" class="return-icon">
        </a>
        <h3>{$money.name}</h3>
    </header> 
    <div class="money-wrapper" style="padding-bottom: 0px;">
        <div class="management-head">
            <div class="management-box">
                <img src="{:getfile($money['cover'])}" alt="" class="management-icon">
                <span class="management-label">{$money.name}</span>
                <ul class="management-list">
                    <li>
                        <span class="percent nianhua">{$money.apr}%起</span>
                        <span class="management-name">年化收益率</span>
                    </li>
                    <li>
                        <span class="period zhouqi">{$money['zhouqi']}天起</span>
                        <span class="management-name">产品周期</span>
                    </li>
                </ul>
                <span class="management-tag">{$money.intro}</span>
                
            </div>
        </div> 
        <ul class="timeline-new">
            <li class="timeline-round">
                <span>{$money.rengou_begin}</span>
            </li>
            <li class="timeline-line">
                <span>认购期</span>
            </li>
            <li class="timeline-round">
                <span>{$money.rengou_end}</span>
            </li>
            <li class="timeline-line" style="padding-left: 1rem;">
                <span>收益期</span>
            </li>
            <li class="timeline-round">
                <span class='shouyiqi'>{$money.get_time}</span>
            </li>
        </ul>
        <div class="product-presentation">
            <h3>产品介绍</h3>
            <p>
                项目方：{$money.xiangmufang}<br />
                租赁额度：{:showprice($money.rengouedu)}USDT起；<br />
                开挖日期：{$money.day}<br />
                理财周期：<span class='zhouqi'>{$money.zhouqi}天</span><br />
                年化收益：<span class='nianhua'>{$money.apr}%</span><br />
                开挖货币：{$money.fanxihuobi}<br />
                返还本金：从开挖之日开始，<span class='zhouqi'>{$money.zhouqi}天</span>后到期。本期到期后，3个工作日返还到用户账户。<br />
                <span> ER获取：投资收益的同时将1:10获得er</span> <br />
            </p>
        </div>
        <div class="btn-box">
            {if $money.buy == 1 }
           <button type="button" class="buy_now pay-btn" data-id="{$money.id}" style='
            width: 100%!important;
            height: 0.95rem!important;
            background: #DEAF5F;
            border-radius: 0.04rem;
            border: none!important;
            color: #FFFFFF;
            font-size: 0.3rem;
            margin-bottom: 0.7rem!important;'>
               立即购买
               </button>
        {else/}
            <button style='
            width: 100%!important;
            height: 0.95rem!important;
            background: #DDDDDD;
            border-radius: 0.04rem;
            border: none!important;
            color: #FFFFFF;
            font-size: 0.3rem;
            margin-bottom: 0.7rem!important;'>立即购买</button>
        {/if}
        </div>
    </div>
    <div class="mask_layer"></div>
    <div class="bottom_window">
        <div class="window_top">
            <div class="window_top_row">
                <span class="window-tag">{$money.type == 1 ? '现货' : '预售'}</span>
                <h3>{$money.name}</h3>
            </div>
            <div class="parameter-box">
                <span class="window-label">购买数量</span>
                <div class="parameter-row">
                    <button data-val='1'>1</button>
                    <button data-val='2'>2</button>
                    <button data-val='5'>5</button>
                    <button data-val='10'>10</button>
                </div>
            </div>
            <div class="window_row_between">
                <span class="window-label">优惠券</span>
                <a href="javascript:void(0)" class="coupon-link">
                    未使用优惠券
                    <img src="../../public/static/images/right_icon2.png" alt="">
                </a>
            </div>
            <div class="window_row_between">
                <span class="window-label">订单金额</span>
                <span class="order-amount"> <span class='danjia'>{:showprice(0)}</span><span class="fontSmall">USDT</span></span>
            </div>
        </div>
        <p class="available-capital">可用资产： {:showprice($data.selfUsdt)} USDT</p>
        <div class="window_bottom">
            <input type="hidden" id="mill_id" value="{$money.id}" />
            <input type="hidden" id="num" value="" />
            <button id='buynow'>购买</button>
        </div>
    </div>
    <script src="../../public/static/common/jQuery/jquery-3.2.1.js"></script>
    <script src="../../public/static/layer/layer.js"></script>
    <script src="../../public/static/common/mui/js/mui.min.js"></script>
    <script>
        //选项卡
        var lang = 1;
        $('.data-tab li a').click(function () {
            let zhouqi, nianhua, shouyi;
            var that = $(this);
            var key = that.data('key');
            console.log("{$money.rengou_end}");
            switch(key) {
                case 1:
                    zhouqi = '1天';
                    lang = '1';
                    nianhua = "{$money.apr_0}%";
                    shouyi = "{$money.get_time_1}";
                    break;
                case 30:
                    zhouqi = '30天';
                    lang = '30';
                    nianhua = "{$money.apr_3}%";
                    shouyi = "{$money.get_time_3}";
                    break;
                case 60:
                    zhouqi = '60天';
                    lang = '60';
                    nianhua = "{$money.apr_6}%";
                    shouyi = "{$money.get_time_6}";
                    break;
                case 90:
                    zhouqi = '90天';
                    lang = '90';
                    nianhua = "{$money.apr_9}%";
                    shouyi = "{$money.get_time_9}";
                    break;
                case 120:
                    zhouqi = '120天';
                    lang = '120';
                    nianhua = "{$money.apr_12}%";
                    shouyi = "{$money.get_time_12}";
                    break;
            } 
        
            $('.nianhua').text(nianhua); //年化收益率
            $(".zhouqi").text(zhouqi); //产品周期
            $(".shouyiqi").text(shouyi); //收益日期
            $('.data-tab li a').removeClass('active');
            that.addClass('active');
        });
        //底部弹框
        $('.pay-btn').click(function () {
            $('.bottom_window,.mask_layer').slideDown(200).css('display', 'flex');
        });
        $('.mask_layer,.cancel-btn').click(function () {
            $('.bottom_window,.mask_layer').slideUp(200).css('display', 'flex');
        })
        //购买数量选择
        $('.parameter-row button').click(function () {
            var that = $(this);
            var num = that.data('val');
            var money = "{:showprice(1)}"
            var allmoney = num;
            $('#num').val(num);
            that.siblings().removeClass('selected');
            that.addClass('selected');
            $('.danjia').text(allmoney);
        });
        let lock = false;
        $('#buynow').click(function () {
            let mill_id = $('#mill_id').val();
            console.log(mill_id)
            let num = $('#num').val();
            let token = localStorage.getItem('token');
 
            if(num == undefined || num == '') {
                mui.toast('请选择购买数量')
                return false;
            }
            if(mill_id == undefined || mill_id == '' ) {
                mui.toast('非法请求')
                return false;
            }
            if(lock == true) {
                return false;
            }
            lock = true;
            
            $.ajax({
                type : "POST",
                contentType: "application/json;charset=UTF-8",
                url : "/api/money/contractPurchase",
                data : JSON.stringify({
                    id:mill_id,
                    num: num,
                    token: token,
                    lang:lang
                }),
                success : function(result) {
                    if(result.code == 200) {
                        console.log(result)
                        setTimeout(function(){
                            window.location.reload();
                        },2000);
                    }else{
                        lock = false;
                    }
                    mui.toast(
                        result.msg
                    )
                },
                //请求失败，包含具体的错误信息
                error : function(e){
                    lock = false;
                    mui.toast(
                        '出错啦，请稍后再试',
                    )
                }
            });
        })
    </script>
</body>

</html>